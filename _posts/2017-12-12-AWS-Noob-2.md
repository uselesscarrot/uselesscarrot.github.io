---
title: AWS로 워드프레스 띄우기(S3, VPC, EC2, RDS)
updated: 2017-12-12
---

# AWS로 워드프레스 띄우기

> 본 포스팅은 <예제를 통해 쉽게 따라하는 아마존 웹 서비스>를 참고하여 작성하였습니다.

## S3

높은 내구성과 가용성을 저렴한 가격으로 제공하는 인터넷 스토리지 서비스. 하나의 저장공간을 구성하고 그 공간에 데이터를 업로드하면 인터넷을 통해 해당 파일을 자유롭게 다운로드 할 수 있습니다. 주체는 다른 인터넷 사용자가 될 수도, 어플리케이션이 될 수도 있습니다.   
일반적인 스토리지는 시간이 지나 수명이 다했거나 물리적인 손상이 생기면 그 안에 담긴 데이터의 내구성/가용성이 훼손되게 됩니다. 그 문제를 극복하고자 만들어진 것이 "객체 스토리지"입니다. 객체 스토리지는 기본적으로 내부 복제를 전제로 하며, 하나의 단위 객체가 업로드되면 자동적으로 내부의 여러 위치에 복제본을 생성합니다. S3의 경우 동일 리전 내의 여러 AZ에 걸쳐 복제본을 생성합니다.   
S3에서 저장할 수 있는 객체의 크기 한도는 5TB로 알려져 있지만, 단일 스레드로 업로드 할 수 있는 최대 한도는 5GB입니다. 큰 크기의 파일을 여러 개로 쪼개서 업로드 하고 추후에 병합하는 작업이 이뤄져 하나의 객체로 저장되며 업로드 속도가 100MB이상으로 빠를 때 권장됩니다.(AWS CLI, AWS SDK를 이용하여 사용 가능)

![객체스토리지 예시](https://uselesscarrot.github.io/assets/aws-noob-objectstorage.png)

내부적으로 복제가 되면, 어느 한 객체에 손상이 발생하더라도 손상되지 않은 복제본이 있기 때문에 내구성이 올라갑니다. 가용성 또한 마찬가지 입니다. 복제본도 원본과 동일하게 실제 다운로드 요청에 응답하는데에 사용되기 때문입니다.   
그러나 내부 복제에는 일정한 시간이 필요하고, 내부 복제가 모두 완료 되기 전에는 각기 다른 객체의 위치에서 응답하기 때문에 사용자별로 일관되지 않은 응답이 발생할 수 있습니다. 일시적인 현상이며 일정 시간(수초 이내)이 지난 후에는 내부 복제가 모두 완료되어 모든 사용자에게 일관된 응답을 제공하게 됩니다. 이것을 Eventual Consistency(최종 일관성)를 제공한다고 표현하며, 이것이 객체 스토리지의 특성이자 S3의 특성이 됩니다.
* 객체의 생성 및 삭제만 지원(덮어쓰기의 경우 삭제 후 재생성 방식)
* 각 객체의 메타데이터의 경우 객체 데이터 외부에 별도로 저장하여 관리(Key-Value)
* 각 객체의 주소값은 유니크 해야함(버킷명+키값+(버전ID)로 구분)
* HTTP(S) 프로토콜을 이용하여 업로드/다운로드 가능

### Bucket과 Object
객체는 파일 및 파일정보로 구성된 저장단위라면, 버킷은 다수의 객체를 통합하여 저장/관리/제어 하는 일종의 바구니. 버킷을 생성한 AWS 계정은 버킷의 오너가 되며, 이 오너는 버킷 단위로 각종 기능을 활성화/비활성화 하거나 버킷 내 객체의 접근제어 정책을 관리할 수 있습니다.   
버킷을 생성할 때는 버킷의 이름, 리전을 선택합니다. 이름은 모든 리전에 걸쳐 고유해야 합니다.

![버킷 만들기](https://uselesscarrot.github.io/assets/aws-noob-makebucket.png)

### S3의 접근제어
![정책 만들기](https://uselesscarrot.github.io/assets/aws-noob-s3policy.png)
* Bucket Operation
* Object Operation

![정책 설정](https://uselesscarrot.github.io/assets/aws-noob-s3policygenerator.png)
* S3 Bucket Policy - Allow - Principal(*) - Amazon S3 - Get Object - arn:aws:s3:::...*
두 가지 범주의 작업을 제어하는 권한계층에는 Bucket ACL(Access Control List), Object ACL, Bucket Policy 세 가지가 있습니다.   
**Bucket Poilicy**의 경우 버킷 단위 작업과 객체 단위 작업을 모두 정의할 수 있고, 정의하는 권한 범위 또한 제한이 없어서 이를 권장.
IAM에서의 S3 정책과 충돌 했을 때에는, [미설정 < 허용 < 거부]순으로 우선순위를 갖습니다.

### S3의 Storage Class

총 네 가지가 있으며, Class별로 보장하는 내구성/가용성/SLA(Service Level Agreement) 기준이 다릅니다.   

![s3 클래스](https://uselesscarrot.github.io/assets/aws-noob-s3class.png)

Glacier의 경우 데이터를 가져오려면 일정 대기시간이 필요합니다. 데이터 검색(Retrieval) 작업이 선행 되어야 하기 때문입니다. 해당 작업이 완료되면 사용자는 24시간 동안만 접근하여 다운로드가 가능합니다. 검색 작업은 대기시간에 따라 긴급(Expedited), 표준(Standard), 대량(Bulk)이 있으며 불러오기 속도는 긴급이 가장 빠르고 대량이 가장 느립니다. 불러오기 작업의 단가는 긴급이 가장 비싸며 대량이 가장 저렴합니다.

### 추가 기능

* Static Website Hosting
![정적 웹 호스팅 설정](https://uselesscarrot.github.io/assets/aws-noob-staticweb.png)

[속성 > 정적 웹 사이트 호스팅]

* Versioning : 동일한 경로로 객체 데이터에 변경(덮어쓰기/삭제)이 발생하더라도 기존 객체 데이터를 보존해 주는 기능
* Lifecycle : 콘텐츠를 저장하거나 백업하는 용도

### 비용

Storage, Request, Data Tranfer로 구성되어 있으며 리전에 따라도 과금 정책이 다르고 시점에 따라도 다르니까 자세한 건 쩜쩜.... 

* Storage : S3에 저장되는 객체 총 데이터량
* Request : S3 버킷 또는 객체 대상으로 수행되는 요청 수
* Data Transfer : S3 - 다른 객체간 전송되는 데이터 크기
---

## VPC(Virtual Private Cloud)

OSI 7계층 :: A Penguin Said That Nobody Drinks Pepsi [Application / Presentation / Sesscion / Transport / Network / Data Link / Physical] :: 중 네트워크 계층에서 통신할 때 IP라는 주소 값을 사용합니다. 주소 값에는 Public IP와 Private IP가 있습니다. 공인 IP는 전 세계 모든 네트워크 공간을 대상 범위로 하는 주소로서 누구나 접속할 수 있는 고유한 값을 가집니다. 사설 IP의 경우 주소값을 외부에서 알기도 힘들 뿐더러 같은 주소 범위에 있지 않는 한 접근할 수 없습니다. VPC는 이런 공간을 나눠주는 가상의 네트워크 공간 서비스 입니다. VPC를 하나 만들어 사설 IP주소 대역을 정의하면(예를 들어, 10.0.0.0/16) 내부적으로는 사설 IP주소값만으로 통신 가능하며, VPC 내부와 외부가 논리적으로 완벽히 분리됩니다. VPC 내부의 객체가 외부와 통신하려면 IGW(Internet Gateway)나 VPG(Virtual Private Gateway)같은 매개체가 필요합니다.   

위에 잠깐 언급한 CIDR 형식의 주소값 (10.0.0.0/16)은 각 자리를 다시 이진수로 바꿔 생각해야 합니다. 10.0.0.0/16의 경우, 00001010.00000000.00000000.00000000으로 바꿔 생각해봅시다. 앞의 16비트는 네트워크 ID가 되고 뒤의 16비트는 호스트 ID가 됩니다. 
(그래서 이게 뭐 어떻다는 건지 잘 모르겠네여... 찾아봐야겠다.)

### Subnet

![VPC와 Subnet](https://uselesscarrot.github.io/assets/aws-noob-vpc.png)

VPC를 구성하려면 먼저 VPC 객체를 생성한 후 해당 VPC의 하위 객체로 Subnet을 생성해야 합니다. VPC 객체와 VPC Subnet 객체를 만들 때에는 둘 모두 각각 사용할 IP주소 대역을 입력해야 합니다. 각 논리적 객체는 AWS에서 관리하는 특정 물리 인프라 단위 내에 반드시 속해야 합니다.   
VPC Subnet은 사설 IP주소 대역을 정의하는 최소 단위의 객체입니다. 논리적으로 반드시 하나의 AZ내에 위치해야 하며, 이 AZ 속성은 이후에 변경이 불가능 합니다. 하나의 Subnet 객체는 목적지별로 어느 네트워크 객체와 통신할지를 정의하는 Route Table 객체와 VPC Subnet 단위로 동작하는 방화벽인 Network ACL 객체를 각각 하나씩 참조(Mapping)해야 하며, 참조하는 객체는 이후에 변경이 가능합니다.   
VPC는 Subnet의 집합입니다. 그러므로 VPC Subnet에서 정의한 주소 대역은 반드시 그 상위 객체은 VPC에서 정의한 주소 대역에 포함되어야 합니다. VPC Subnet 객체는 하나의 AZ 내에 속해 있으므로 VPC Subnet의 집합인 VPC 객체는 논리적으로 여러 AZ에 걸쳐 있는 객체가 됩니다. VPC 객체는 반드시 하나의 리전 내에 구성되어야 하며, 이 또한 이후에 변경이 불가능합니다. AZ단위로는 걸칠 수 있지만 Region 단위로는 걸칠 수 없습니다.   

### ENI(Elastic Network Interface)
사설 IP주소 정보를 갖고 있는 일종의 네트워크 카드(NIC). EC2 인스턴스에 붙여 사용하게 되며, 특정 조건에서 기존 EC2에서 ENI 객체를 떼다가 새로운 EC2에 붙여 사용할 수도 있습니다. 기본적으로 하나의 ENI는 하나의 사설 IP주소값을 갖습니다. 하지만 사용자가 원한다면 하나의 ENI에 두 개 이상의 사설 IP를 정의(Secondary IP)할 수도 있습니다. 결과적으로 EC2 인스턴스 하나에는 하나 또는 두개 이상의 사설 IP를 매핑하여 사용할 수 있게 됩니다. 이 ENI 객체 단위로 방화벽 기능을 하는 보안 그룹 객체를 참조하여 사용합니다. 하나의 ENI 객체에는 최대 5개까지 보안 그룹 객체를 붙여 사용할 수 있습니다. 
   
하나의 Subnet 객체에는 하나의 Route Table과 하나의 Network ACL 객체를 참조해야 합니다.   
Network ACL은 Subnet 계층에서 동작하는 방화벽 서비스입니다. 해당 VPC Subnet으로 네트워크 패킷이 진입In하거나 나갈Out때 적용할 접근제어 규칙을 정의합니다.   
Route Table은 해당 Subnet 내에 속한 ENI 객체로부터 시작되는 네트워크 패킷이 목적지 주소에 따라 어느 대상으로 가야하는지를 정의하는 표지판과 비슷한 역할을 합니다. 하나의 라우트 테이블 객체가 있고 그 하위 속성으로 여러 개의 라우팅 룰을 정의하여 사용합니다. 정의할 수 있는 대상으로는 IGW, VPG, 특정 ENI, VPC Endpoint, VPC Peering, NAT Gateway 등이 있습니다. 대표적으로는 IGW와 VPG가 있으며 인터넷 구간과 직접 통신하기를 원할 경우 대상을 IGW로, VPN또는 다이렉트 코넥트로 연동된 온프레미스의 사설 네트워크 구간과 통신하기를 원할 경우 관련 VPG를 대상으로 지정하면 됩니다.

![Subnet](https://uselesscarrot.github.io/assets/aws-noob-vpcsubnet.png)

### Public Subnet - Private Subnet
* Public Subnet : 라우트 테이블 객체에 IGW로 가는 라우팅 룰이 있음. ENI는 IGW를 통해 바로 인터넷 구간과 통신.
* Private Subnet : 라우트 테이블 객체에 IGW로 가는 라우팅 룰이 없음. NAT Gateway나 NAT 용도로 설정된 EC2 인스턴스를 프록시(EC2의 ENI 추가)하여 인터넷 구간과 통신. 이때, NAT용으로 사용되는 단위 객체는 반드시 Public IP를 가지고 Public Subnet에 위치해야 함.
- 고정적인 것이 아니며 라우트 테이블 객체의 룰을 수정하면 언제든 수정가능.

#### VPC 주소 대역을 설계할 때 고려해야 할 것   
VPC 또는 VPC Subnet의 CIDR 대역은 한 번 지정하면 이후에 수정할 수 없으므로 신중히 고려하여 정해야 합니다. 
 * VPC와 VPC Subnet 내부에 생성할 인프라의 규모(사용 가능한 사설 IP주소값)
 * 다른 네트워크 주소공간(온프레미스나 다른 VPC 객체)과 연동할 경우 연동하는 공간의 사설 IP주소 대역과 CIDR이 겹치지 않게 설정(라우팅 테이블의 라우팅 룰 정의 불가)
 
## VPC 기능
### VPC Peering

### NAT Gateway

### VPC Endpoint

